<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>

		<% user=@user %>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Untitled Document</title>
		
		<style type="text/css"> 

			ul.profile_menu, ul.profile_menu, li.profile_menu{
				display: block;
				list-style: none;
				margin: 0;
				padding: 0;
			}
		
			ul.profile_menu{
				float: left;
				width:90%;
				background:none;
				padding: 1px 0 1px 1px;

				float: left;
			}
			

			 li.profile_menu span.profile_menu{
			 	width:20%;
				border: 1px solid #fff;
				float: left;	
				margin:0px;
				padding:5px;
				text-align:center;
				font-weight:bold;
			}
			
			 ul.profile_menu,  ul.profile_menu{
				text-decoration: none;
				display: block;

				background: none;
				color: #fff;

				

			}
			
			ul.profile_menu span:hover {
				color:#8DBDE5;
				
				cursor:pointer;
			}
			span#link_to_film a:hover {
				color:#EE4242;
			}
			span#link_to_film a {
				color:#146CB4;
				font-weight: bold;
			}
			
			
			div.btn{
				float:left;
				color: #000000;

				padding:5px;
				text-align:center;
				background: #8DBDE5;
				border:solid 1px #c3c3c3;
				cursor:pointer;
				position:fixed;
				top:35%;
				left:45%;
				margin:10px;				
			}
			div.form{
				left: 5%;

			}
			
			#tickety{
				width:100%;
				border-collapse:collapse;

			}
			
			#tickety table, #tickety td, #tickety th{
				border:1px solid #8DBDE5;
				font-size:1em;
				padding:3px 7px 2px 7px;
				background-color:#CCCCCC;
				color:black;				
			}
			#tickety th{
				background-color:black;
				color:white;
			}
			#tickety tr.alt td{		
				background-color:white;
			}


		
		</style>
		<script>
			var current=0;
			
			function showRes(){
				if(current!=1){
					document.getElementById('curr').style.color='#EE4242';
					document.getElementById('pri').style.color='white';
					document.getElementById('his').style.color='white';
					document.getElementById('edi').style.color='white';
					$j('.divki').hide();
					$j('.currentTickets').slideToggle('slow');
					current=1;
				}
			}
			function printTickets(){
				if(current!=2){
					document.getElementById('curr').style.color='white';
					document.getElementById('pri').style.color='#EE4242';
					document.getElementById('his').style.color='white';
					document.getElementById('edi').style.color='white';
					$j('.divki').hide();
					$j('.printTickets').slideToggle('slow');
					current=2;
				}
			}
			
			function showHistory(){
				if(current!=3){
					document.getElementById('curr').style.color='white';
					document.getElementById('pri').style.color='white';
					document.getElementById('his').style.color='#EE4242';
					document.getElementById('edi').style.color='white';
					$j('.divki').hide();
					$j('.History').slideToggle('slow');
					current=3;
				}
			}			
			
			function showEdit(){
				if(current!=4){
					document.getElementById('curr').style.color='white';
					document.getElementById('pri').style.color='white';
					document.getElementById('his').style.color='white';
					document.getElementById('edi').style.color='#EE4242';					
					$j('.divki').hide();
					$j('.form').slideToggle('slow');
					$j('.pwd').slideToggle('slow');
					current=4;
				}
			}
			
		</script>
		
	</head>
	<body>

		<div>
			<ul class="profile_menu">
				<li class="profile_menu"><span class="profile_menu" id="curr" onclick="showRes();">Bieżące rezerwacje</span></li>
				<li class="profile_menu"><span class="profile_menu" id="pri" onclick="printTickets();">Drukowanie biletów</span></li>
				<li class="profile_menu"><span class="profile_menu" id="his" onclick="showHistory();">Historia</span></li>							
				<li class="profile_menu"><span class="profile_menu" id="edi" onclick="showEdit();">Edytuj konto</span></li>
			</ul>
		</div>
		<br /><br />

		<div style="float:left;" hidden=true>
			<p>Witaj, <%= user.login %>!</p>
		</div>
		

		

		<div>
			<div class="form divki" style="float:right;" hidden=true >
				<%= form_for(@user) do |u| %>
				  <% if @user.errors.any? %>
				    <div id="error_explanation">
				      <h2>Zaszły następujące nieprawidłowości:</h2>
				      <ul>
				      <% @user.errors.full_messages.each do |msg| %>
				        <li><%= msg %></li>
				      <% end %>
				      </ul>
				    </div>
				  <% end %>
				
				  <div class="field">
				    <span style="left: 0%"><%= u.label :login %></span><br />
				    <%= u.text_field :login, :class => 'validate[required,maxSize[100]]', :size=>45 %>
				  </div>
				  
				  <div class="field">
				  	<span style="float: left"><%= u.label 'Imię' %></span><br />
				    <%= u.text_field :first_name, :class => 'validate[required,maxSize[20]]', :size=>45 %>			 
				  </div>
				  
				  <div>
				  	<span style="float: left"><%= u.label 'Nazwisko' %></span><br />
				    <%= u.text_field :last_name, :class => 'validate[required,maxSize[100]]', :size=>45 %>
				  </div>	
				  		  
				  <div class="field">
				    <span style="float: left"><%= u.label :email%></span><br />
				    <%= u.text_field :email, :class => 'validate[required,maxSize[50]]', :size=>45 %>
				  </div>
		
				  <div class="field">
				    <span style="float: left"><%= u.label :"telefon" %></span><br />
				    <%= u.text_field :phone, :size=>45 %>
				  </div>
				  			  
				  <div class="actions">
				    <%= u.submit "Zapisz"%>
				  </div>
				<% end %>
			</div>
	
			<div class="pwd divki" style="float:right;" hidden=true>
				<%= form_for(@user) do |us| %>
				  <% if @user.errors.any? %>
				    <div id="error_explanation">
				      <h2>Zaszły następujące nieprawidłowości:</h2>
				      <ul>
				      <% @user.errors.full_messages.each do |msg| %>
				        <li><%= msg %></li>
				      <% end %>
				      </ul>
				    </div>
				  <% end %>		  
				  
				  <div class="field">
				    <span style="float: left"><%= us.label :"hasło" %></span><br />
				    <%= us.password_field :hashed_password, :size=>45, :value=> "" %>
				  </div>
				  
				  <div class="field">
				    <span style="float: left"><%= us.label :"potwierdź hasło" %></span><br />
				    <%= us.password_field :hashed_password_confirmation, :size=>45 %>
				  </div>	  
					  	
				  <div class="actions">
				    <%= us.submit "Zapisz"%>
				  </div>
				<% end %>
			</div>	
		</div>	
		
		<div class="currentTickets divki" hidden=true>
			<%#currentReserv=@tickets.reservation.id%>
				<br />
				<table id="tickety">
						<tr>
							<th>tytuł</th>
							<th>kino</th>
							<th>termin</th>
							<th>rząd</th>
							<th>kolumna</th>
							<th>bilet</th>
							<th>cena</th>
						</tr>
					<% i=1 %>	
					<% for ticket in @tickets do-%>
						<% time = ticket.seance.time_from %>
						<% date = ticket.seance.date_from%>						
						<% if ticket.cancelled!=true && ticket.bought!=true%>
						<tr <%=  if i%2==1 then "class=alt" end %> >
							<td><%= ticket.seance.cinema_film.film.title %></td>
							<td><%= ticket.seance.cinema_film.cinema.name %></td>
							<td><%= date.strftime("%d.%m.%Y") + time.strftime(" %H:%M") %></td>
							<td><%= ticket.seat.row %></td>
							<td><%= ticket.seat.column %></td>
							<td><%= ticket.ticket_type.name %></td>
							<td><%= ticket.price.to_s %></td>
							<td style="background:none; border: none;">
								<%= link_to( 'zrezygnuj', { :action=>"delete_ticket", :id=>ticket.id.to_s} ) %>
							</td>
							<% i=i+1 %>
						<% end %>
					<% end %>
			
				</table>
				<br />
				<table style="width: 25%; ">
					<tr>
						<td style="font-weight: bold;">suma: </td>
						<td >
							<%= link_to( 'zapłać', { :action=>"profile", :id=>user.id} ) %>
						</td>
					</tr>
				</table>
		</div>
		
		
		<div class="divki printTickets" hidden=true>
				<br />
				<table id="tickety">
						<tr>
							<th>tytuł</th>
							<th>kino</th>
							<th>termin</th>
							<th>rząd</th>
							<th>kolumna</th>
							<th>bilet</th>
							<th>cena</th>
						</tr>
					<% i=1 %>	
					<% for ticket in @tickets do-%>
						<% time = ticket.seance.time_from %>
						<% date = ticket.seance.date_from%>							
						<% if ticket.bought==true && ((time> Time.now && date==DateTime.now) || date>DateTime.now) %>
						<tr <%=  if i%2==1 then "class=alt" end %> >
							<td><%= ticket.seance.cinema_film.film.title %></td>
							<td><%= ticket.seance.cinema_film.cinema.name %></td>
							<td><%= date.strftime("%d.%m.%Y") + time.strftime(" %H:%M") %></td>
							<td><%= ticket.seat.row %></td>
							<td><%= ticket.seat.column %></td>
							<td><%= ticket.ticket_type.name %></td>
							<td><%= ticket.price.to_s %></td>
							<td style="background:none; border: none;">
								<%= link_to( 'drukuj', { :action=>"profile", :id=>user.id} ) %>
							</td>
							<% i=i+1 %>
						<% end %>
					<% end %>
			
				</table>

		</div>
		
				<div class="divki History" hidden=true>
				<br />
				<table id="tickety">
						<tr>
							<th>tytuł</th>
							<th>kino</th>
							<th>termin</th>
							<th>bilet</th>
							<th>cena</th>
							
		
						</tr>
					<% i=1 %>	
					<% for ticket in @tickets do-%>
						<% time = ticket.seance.time_from %>
						<% date = ticket.seance.date_from%>							
						<% if ticket.bought==true && ((time< Time.now && date==DateTime.now) || date<DateTime.now) %>
						<tr <%=  if i%2==1 then "class=alt" end %> >
							<td>
								<span id="link_to_film">
								<%=link_to(ticket.seance.cinema_film.film.title.to_s, {:action=>"dane_filmu", :id=>ticket.seance.cinema_film.film.id }) %>
								</span>
							</td>
							<td><%= ticket.seance.cinema_film.cinema.name %></td>
							<td><%= date.strftime("%d.%m.%Y") + time.strftime(" %H:%M") %></td>
							<td><%= ticket.ticket_type.name %></td>
							<td><%= ticket.price.to_s %></td>

							<% i=i+1 %>
						<% end %>
					<% end %>
			
				</table>

		</div>
		<script>
			showRes();
		</script>
	</body>
</html>
