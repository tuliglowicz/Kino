<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
	<head>

		<% user=@user %>
		<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
		<title>Untitled Document</title>
		
		<style type="text/css"> 
		div.btn{
			float:left;
			color: #000000;
			margin:0px;
			padding:5px;
			text-align:center;
			background: #8DBDE5;
			border:solid 1px #c3c3c3;	
		}
		div.form{margin:10px;}

		</style>
	</head>
	<body>
		
	<script>
		jQuery(document).ready(function(){
	    // binds form submission and fields to the validation engine
	    jQuery("#new_user").validationEngine('attach', { validationEventTrigger: 'submit'});
	    jQuery("#edit_user_<%= @user.id %>").validationEngine('attach', { validationEventTrigger: 'submit'});
	    
	    jQuery("#user_login").blur(function(){
	    	var login = jQuery("#user_login").val();
	    	if(login.length > 3){
	    		var login_availability = jQuery.ajax({
	    			type: "POST",
		    		url: "http://localhost:3000/private/users/login_availability",
		    		data: "login=" + login,
		    		
		    		success: function(message)
		    		{	    		
		    			jQuery("#login_status").show('fast');
		    			if (message == 'OK') 
		    			{				
		    				jQuery("#login_status").css("color", "lime");
		    				jQuery("#login_status").text("Login dostępny");
		    			}
		    			else
		    			{	    				
		    				jQuery("#login_status").css("color", "red");
		    				jQuery("#login_status").text("Login niedostępny");
		    			}
		    		},
		    		error: function()
		    		{
		    			alert('Sprawdzenie dostępności nie powiodło się.');
		    		}
	    		});
	    	}
	    	else
	    	{
	    		jQuery("#login_status").hide('fast');
	    	}
	    	
	    });
	 }); 
	 function x(){
	 	document.writeln("dzialam");
	 	$j(document).ready(function(){
    			$(".form").slideToggle("slow");
  		});
	}
	</script>


		
		<div style="float:left;">
			<p>Witaj, <%= user.login %>!</p>
		</div>
		<br /><br />
		<div class="btn" onclick="$j('.form').slideToggle('slow');">
			edytuj swoje dane
		</div>
		<div class="form" style="float:right;" hidden="true">
			<%= form_for(@user) do |u| %>
			  <% if @user.errors.any? %>
			    <div id="error_explanation">
			      <h2>Zaszły następujące nieprawidłowości:</h2>
			      <ul>
			      <% @user.errors.full_messages.each do |msg| %>
			        <li><%= msg %></li>
			      <% end %>
			      </ul>
			    </div>
			  <% end %>
			
			  <div class="field">
			    <%= u.label :login %><br />
			    <%= u.text_field :login, :class => 'validate[required,maxSize[100]]', :size=>45 %>
			  </div>
			  <div class="field">
			    <%= u.label :email%><br />
			    <%= u.text_field :email, :class => 'validate[required,maxSize[50]]', :size=>45 %>
			  </div>
	
			  <div class="field">
			    <%= u.label :"telefon" %><br />
			    <%= u.text_field :phone, :size=>45 %>
			  </div>
			  
			  <div class="field">
			    <%= u.label :"hasło"%><br />
			    <%= u.text_field :hashed_password, :class => 'validate[required,maxSize[50]]', :size=>45 %>
			  </div>			  
	
			  <div class="actions">
			    <%= u.submit "Zapisz"%>
			  </div>
			<% end %>
		</div>	
	</body>
</html>
